
<a href="https://www.vonage.com/">
    <img src="public/logo.png" alt="Vonage logo" title="Vonage" align="right" height="60" />
</a>

# js-workerizer
Library providing a simple way to run a class instance on its dedicated worker.

## Table of content

- [Installation](#installation)
- [License](#license)
- [Links](#links)


## Installation

### Requirements
* [Node 16.13.0](https://nodejs.org/en/)

### Installation

``` bash
# Install dependencies
npm install @vonage/js-workerizer
```



### Running example

``` bash
# from the example/basic directory
npm install
npm run dev
```

## Quick start

### Short example


```ts
import { MyWorkerizableClass } from "./my-workerizable-class.ts";
import Worker from "./my-workerizable-class.ts?worker&inline";

const onMainThread = new MyWorkerizableClass();
onMainThread.doSomething(); // run on the main thread

const onAWorker = await workerize(MyWorkerizableClass, Worker);
await onMainThread.doSomething(); // run on a worker
```

### Run a class in a worker

Imaging you want to run this class in a worker. 
``` ts
export class HugeProcessClass {
    run() {
        // ... super slow process
    }
}

// Class usage
const process = new HugeProcessClass();
process.run(); // will run on the main thread
```

1. First step is to make the class instantiable from the worker.
To achieve it, you must use the registerWorker function.

We suggest to call it in the static constructor of the class.
Decorator should be provided soon as typescript release them.

``` ts
export class HugeProcessClass {
    // ... class impl
    
    // These lines allow the class to be used in a worker
    static {
        registerWorker('HugeProcessClass', this);
    }
}
```

2. Second, you need to instantiate the class as a worker using workerize function instead of new operator.
``` ts
// Class usage
const process = await workerize(HugeProcessClass);
await process.run(); // will run on a worker
```

### Terminate a worker
``` ts

export class SomeClass {    
    // this method will be call if defined before the worker is terminated
    public terminate() {
    }
    
    // These lines allow the class to be used in a worker
    static {
        registerWorker('HugeProcessClass', this);
    }
}


// Class usage
const worker = await workerize(SomeClass);
await worker.terminate();
```


## License

This project is licensed under the terms of the [MIT license](https://opensource.org/licenses/MIT) and is available for free.

## Links

* [Documentation](https://github.com/Vonage/js-workerizer/wiki/Documentation)
* [Source code](https://github.com/Vonage/js-workerizer)